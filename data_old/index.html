<html>

<head>
    <link href="style.css" rel="stylesheet" type="text/css" />
    <meta charset="utf-8">
    <title>ESP8266 多国语言翻译系统</title>
    <script defer="defer">
        window.onload = function () {
            var xmlhttp;
            if (window.XMLHttpRequest) {
                xmlhttp = new XMLHttpRequest();
            } else {
                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlhttp.onreadystatechange = function () {
                var btnLed = document.getElementById("btnLed");
                var lang = document.getElementById("language");
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    var obj = JSON.parse(xmlhttp.responseText);
                    setLEDButton(document.getElementById("btnLed"), obj["ledstate"]);
                    for (var i = 0; i < lang.length; i++) {
                        if (obj["language"] == lang.options[i].value) {
                            lang.options[i].selected = "selected";
                        }
                    }
                    // showReturnMsg("Success","初始化完成");
                }
                else if (xmlhttp.readyState == 4) showReturnMsg("Error", "初始化失败");
            };
            // showReturnMsg("Info", "正在进行页面初始化...");
            xmlhttp.open("GET", "Init", true);
            xmlhttp.send();

            //循环执行，每隔1秒钟执行一次 1000 
            var t1 = window.setInterval(refreshTemperature, 5000);
            function refreshTemperature() {
                var xmlhttp;
                if (window.XMLHttpRequest) {
                    xmlhttp = new XMLHttpRequest();
                } else {
                    xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
                }
                xmlhttp.onreadystatechange = function () {
                    var temperature = document.getElementById("temperature");
                    var Humidity = document.getElementById("Humidity");
                    var computeHeat = document.getElementById("computeHeat");
                    var HumenActive = document.getElementById("HumenActive");
                    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                        var obj = JSON.parse(xmlhttp.responseText);
                        var haobj = obj["HumenActive"];
                        temperature.innerHTML = obj["temperature"];
                        Humidity.innerHTML = obj["Humidity"];
                        computeHeat.innerHTML = obj["computeHeat"];
                        if(haobj["status"] == true) {
                            HumenActive.innerHTML = "有人员活动";
                        }
                        else {
                            HumenActive.innerHTML = "无人员活动";
                        }
                        var str = "";
                        var strmins = "";
                        for(var i in haobj["list"]) {
                            str += "<div class='logline'>";
                            str += "<div class='datetime'>" + haobj["list"][i]["start"] + " - " + haobj["list"][i]["end"] + "</div>";
                            str += "<div class='mins'>< " + haobj["list"][i]["mins"] + " ></div>";
                            str += "</div>"
                        }
                        document.getElementById("HALog").innerHTML = str;
                    }
                };
                xmlhttp.open("GET", "getTemperature", true);
                xmlhttp.send();
            }
            // 去掉定时器的方法  
            // window.clearInterval(t1);   
        };
        function showReturnMsg(type, msg) {
            obj = document.getElementById("responseState");
            obj.innerHTML = msg;
            obj.className = type;
        };
        function setLEDButton(btnLed, stateValue) {
            btnLed.className = stateValue == "on" ? "ledon" : "ledoff";
            btnLed.innerHTML = stateValue == "on" ? "关闭板载LED灯" : "打开板载LED灯";
        };
        function ledSwitch() {
            var xmlhttp;
            if (window.XMLHttpRequest) {
                xmlhttp = new XMLHttpRequest();
            } else {
                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    var stateValue = xmlhttp.responseText;
                    setLEDButton(document.getElementById("btnLed"), stateValue);
                    showReturnMsg("Success", "操作成功");
                }
                else if (xmlhttp.readyState == 4) showReturnMsg("Error", "操作失败");
            };
            showReturnMsg("Info", "正在发送操作指令...");
            xmlhttp.open("GET", "Switch", true);
            xmlhttp.send();
        };
        function doTranslate(ele, language, target) {
            if (ele.value == undefined || ele.value.trim() == "") {
                target.innerHTML = "";
                return;
            }
            var xmlhttp;
            if (window.XMLHttpRequest) {
                xmlhttp = new XMLHttpRequest();
            } else {
                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    target.innerHTML = xmlhttp.responseText;
                    showReturnMsg("Success", "翻译成功");
                }
                else if (xmlhttp.readyState == 4 && ele.value != "") showReturnMsg("Error", "翻译失败");
            };
            showReturnMsg("Info", "正在努力翻译中...");
            xmlhttp.open("POST", "Translate", true);
            xmlhttp.send("lang=" + language.options[language.selectedIndex].value + "&text=" + ele.value);
        };
        function copyToClipboard(ele) {
            var val = ele.innerHTML;
            if (val == "" || val == undefined) {
                return;
            }
            var inputEle = document.createElement('input');
            document.body.appendChild(inputEle);
            inputEle.value = val;
            inputEle.readonly = "readonly";
            inputEle.select();
            document.execCommand('copy');
            document.body.removeChild(inputEle);
            showReturnMsg("Info", "译文已复制到剪贴板");
        };
    </script>
</head>

<body>
    <center>
        <div style="text-align:left;width:80%">
            <center>
                <h3>ESP8266 多国语言翻译系统</h3>
            </center>
            <label for="srcText">请输入需要翻译的文本:</label>
            <textarea class=inputCtrl id=srcText onchange="doTranslate(this, document.getElementById('language'), document.getElementById('targetText'))"></textarea>
            <label for="language">目标语言: </label>
            <select class=inputCtrl id=language onchange="doTranslate(document.getElementById('srcText'), this, document.getElementById('targetText'))">
                <option value="zh">中文</option>
                <option value="en">English - 英语</option>
                <option value="yue">粤语</option>
                <option value="wyw">文言文</option>
                <option value="jp">日本語</option>
                <option value="kor">한국어 - 韩语</option>
                <option value="fra">Le français - 法语</option>
                <option value="spa">Español - 西班牙语</option>
                <option value="th">ไทย - 泰语</option>
                <option value="ara">العربية - 阿拉伯语</option>
                <option value="ru">русский - 俄语</option>
                <option value="pt">Português - 葡萄牙语</option>
                <option value="de">Deutsch - 德语</option>
                <option value="it">lingua italiana - 意大利语</option>
                <option value="el">Ελληνικά - 希腊语</option>
                <option value="nl">Nederlands - 荷兰语</option>
                <option value="pl">Polski - 波兰语</option>
                <option value="bul">български - 保加利亚语</option>
                <option value="est">Eesti keel - 爱沙尼亚语</option>
                <option value="dan">dansk - 丹麦语</option>
                <option value="fin">suomalainen - 芬兰语</option>
                <option value="cs">Česky - 捷克语</option>
                <option value="rom">românesc - 罗马尼亚语</option>
                <option value="slo">Slovenščina - 斯洛文尼亚语</option>
                <option value="swe">Svenska - 瑞典语></option>
                <option value="hu">magyar - 匈牙利语</option>
                <option value="cht">繁體中文</option>
                <option value="vie">Tiếng việt - 越南语</option>
            </select></p>

            <label for="targetText">译文：</label><br /><span class="response" id="targetText"></span></p>
            <button type="button" id=btnclipboard onclick="copyToClipboard(document.getElementById('targetText'))">复制到剪贴板</button>

            <center>
                <p></p>
                <hr />
                <p></p><button type="button" id="btnLed" class="ledoff" onclick="ledSwitch()">打开板载LED灯</button>

                <p></p>
                <hr />
                <p></p>
                <table>
                    <tr>
                        <td class="label">气温</td>
                        <td id="temperature" class="cvalue"></td>
                        <td class="label">湿度</td>
                        <td id="Humidity" class="cvalue"></td>
                    </tr>
                    <tr>
                        <td class="label">体感温度</td>
                        <td id="computeHeat" class="cvalue"></td>
                        <td class="label">人员活动</td>
                        <td id="HumenActive" class="cvalue"></td>
                    </tr>
                    <tr>
                        <td class="label">活动记录</td>
                        <td colspan=3 class="cvalue" id="HALog"></td>
                    </tr>
                </table>
            </center>
            <p></p>
            <hr />
            <p></p><label for="responseState">反馈：</label><span class="rtnOK" id="responseState"></span>

            <div style="width:100%">
                <center>
                    <ul class="navbar ml-auto">
                        <li><a href="snake.html">贪吃蛇</a></li>
                        <li><a href="roundArr.html">动态鼠标轨迹</a></li>
                    </ul>
                </center>
            </div>

            <br />
            <center><img src="shans.png" alt="山水图" /></center>
        </div>
    </center>
</body>

</html>